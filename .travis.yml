sudo: true

language: go

# Skip install step. Control by ourself
install: true

matrix:
  fast_finish: true
  include:
    - go: "1.10.x"
      addons:
        apt:
          sources:
            - ubuntu-toolchain-r-test
          packages:
            - g++-4.9
      before_script:
        - sudo echo 'deb http://apt.llvm.org/trusty/ llvm-toolchain-trusty-6.0 main' >> /etc/apt/sources.list
        - sudo echo 'deb-src http://apt.llvm.org/trusty/ llvm-toolchain-trusty-6.0 main' >> /etc/apt/sources.list
        - wget -O - https://apt.llvm.org/llvm-snapshot.gpg.key|sudo apt-key add -
        - sudo apt update
        - sudo apt-get install clang-6.0 clang-tools-6.0 clang-6.0-doc libclang-common-6.0-dev libclang-6.0-dev libclang1-6.0 clang-format-6.0 python-clang-6.0
        - sudo apt-get install libllvm6.0 llvm-6.0 llvm-6.0-dev llvm-6.0-doc llvm-6.0-examples llvm-6.0-runtime
        - sudo apt-get install libfuzzer-6.0-dev
        - sudo apt-get install lldb-6.0
        - sudo apt-get install lld-6.0
        - go get -t -v ./...
      script:
        - go test -coverprofile=coverage.txt -v ./...

