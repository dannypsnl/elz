sudo: true

language: go

go:
  - 1.9
  - master

# Skip install step. Control by ourself
install: true

matrix:
  allow_failures:
    - go: master
  # This mean if stable go version pass the test, will mark test green
  fast_finish: true
  include:
    - go: "1.10.x"
      before_script:
        - wget -O - https://apt.llvm.org/llvm-snapshot.gpg.key|sudo apt-key add -
        - sudo apt update
        - sudo apt-get install libllvm-7-ocaml-dev libllvm7 llvm-7 llvm-7-dev llvm-7-doc llvm-7-examples llvm-7-runtime
        - sudo apt-get install clang-7 clang-tools-7 clang-7-doc libclang-common-7-dev libclang-7-dev libclang1-7 clang-format-7 python-clang-7
        - sudo apt-get install libfuzzer-7-dev
        - sudo apt-get install lldb-7 lld-7
        - sudo apt-get install libc++-7-dev libc++abi-7-dev
        - go get -t -v ./...
      script:
        - go test -coverprofile=coverage.txt -v ./...

services:
  - docker

before_script:
  - go get github.com/mattn/goveralls
  - go get -d github.com/elz-lang/elz
  - cd $GOPATH/src/github.com/elz-lang/elz/
  - docker build -t runtest .

script:
  # Cover default test command
  - go test ./collection/stack/
  - docker run --name elztest -v $GOPATH/src/github.com/elz-lang/elz:/go/src/github.com/elz-lang/elz runtest
  - goveralls -coverprofile=overalls.coverprofile -service=travis-ci -repotoken q1SjUrwywcLURT4eok5Ki37gXZeGZiwg4
  - docker rm elztest
