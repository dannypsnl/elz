sudo: true

language: go

# Skip install step. Control by ourself
install: true

matrix:
  fast_finish: true
  include:
    - go: "1.10.x"
      addons:
        apt:
          sources:
            - ubuntu-toolchain-r-test
          packages:
            - g++-4.9
      env:
        - CGO_CXXFLAGS=-std=c++11
        - CGO_CPPFLAGS="`llvm-config --cppflags`"
        - CGO_LDFLAGS="`llvm-config --ldflags --libs --system-libs all`"
        - CGO_LDFLAGS_ALLOW='-Wl,(-search_paths_first|-headerpad_max_install_names)'
        - CC=clang
        - CXX=clang++
      before_script:
        - sudo echo 'deb http://apt.llvm.org/trusty/ llvm-toolchain-trusty-7 main' >> /etc/apt/sources.list
        - sudo echo 'deb-src http://apt.llvm.org/trusty/ llvm-toolchain-trusty-7 main' >> /etc/apt/sources.list
        - wget -O - https://apt.llvm.org/llvm-snapshot.gpg.key|sudo apt-key add -
        - sudo apt update
        - sudo apt-get install clang-7 clang-tools-7 clang-7-doc libclang-common-7-dev libclang-7-dev libclang1-7
        - sudo apt-get install libllvm7 llvm-7 llvm-7-dev llvm-7-doc llvm-7-examples llvm-7-runtime
        - sudo apt-get install libfuzzer-7-dev
        - sudo apt-get install lldb-7
        - sudo apt-get install lld-7
        - ls -a /usr/local/bin
        - ls -a /usr/local/clang
        - ls -a /usr/local/clang/bin
        - ls -a /usr/local/clang/include
        - ls -a /usr/local/clang/include/llvm-c
        - llvm-config --cppflags
        - llvm-config --includedir
        - ls -la $(llvm-config --includedir)
        - ls -la $(llvm-config --includedir)/llvm-c
        - go get -t -v ./...
      script:
        - go test -coverprofile=coverage.txt -v ./...


